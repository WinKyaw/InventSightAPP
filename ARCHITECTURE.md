# Receipt Page Fixes - Architecture Diagram

## Component Architecture

```
App (_layout.tsx)
â”‚
â”œâ”€â”€ AuthProvider
â”‚   â””â”€â”€ StoreProvider â­ NEW â­
â”‚       â””â”€â”€ OfflineProvider
â”‚           â””â”€â”€ ItemsProvider
â”‚               â””â”€â”€ ReceiptProvider
â”‚                   â””â”€â”€ ...other providers...
â”‚                       â””â”€â”€ App Screens
â”‚                           â”œâ”€â”€ Items Screen
â”‚                           â”‚   â””â”€â”€ Uses useStore() hook
â”‚                           â”‚       â””â”€â”€ setCurrentStore(store)
â”‚                           â”‚
â”‚                           â””â”€â”€ Receipt Screen
â”‚                               â””â”€â”€ Uses useStore() hook
â”‚                                   â””â”€â”€ Reads currentStore
```

## Store Context Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        StoreContext                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ State:                                                  â”‚ â”‚
â”‚  â”‚  - currentStore: Store | null                          â”‚ â”‚
â”‚  â”‚  - isStoreReady: boolean                               â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚ Methods:                                                â”‚ â”‚
â”‚  â”‚  - setCurrentStore(store: Store | null)                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                          â”‚
                    â”‚                          â”‚
                    â–¼                          â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Items Screen       â”‚  â”‚   Receipt Screen     â”‚
        â”‚                      â”‚  â”‚                      â”‚
        â”‚  const { current-   â”‚  â”‚  const { current-    â”‚
        â”‚  Store, setcurrent- â”‚  â”‚  Store, isStore-     â”‚
        â”‚  Store } = useStore()â”‚  â”‚  Ready } = useStore()â”‚
        â”‚                      â”‚  â”‚                      â”‚
        â”‚  [Store Selector]   â”‚  â”‚  [Display Store]     â”‚
        â”‚  onClick: set-      â”‚  â”‚  [Validate Store]    â”‚
        â”‚  CurrentStore()     â”‚  â”‚  [Create Receipt]    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Receipt Creation Flow (New)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Receipt Creation Flow                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: User on Items Page
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Items Screen       â”‚
â”‚                      â”‚
â”‚  [Store Selector]    â”‚ â”€â”€â–º User selects "Downtown Store"
â”‚  â–¼ Downtown Store    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ StoreContext.setCurrentStore(Downtown Store)
         â”‚
         â–¼

Step 2: User navigates to Receipt Page
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Receipt Screen      â”‚
â”‚                      â”‚
â”‚  Store: Downtown     â”‚ â—„â”€â”€ Reads from StoreContext
â”‚  [Add Items]         â”‚
â”‚  [Save as Pending]   â”‚ â—„â”€â”€ NO payment method
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ User clicks "Save as Pending Receipt"
         â”‚
         â–¼

Step 3: Create Pending Receipt
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  handleCreate-       â”‚
â”‚  PendingReceipt()    â”‚
â”‚                      â”‚
â”‚  Validates:          â”‚
â”‚  âœ“ Store selected?   â”‚
â”‚  âœ“ Items added?      â”‚
â”‚                      â”‚
â”‚  POST /api/receipts  â”‚
â”‚  {                   â”‚
â”‚    storeId: "uuid"   â”‚
â”‚    status: "PENDING" â”‚
â”‚    items: [...]      â”‚
â”‚    // NO payment     â”‚
â”‚  }                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼

Step 4: Receipt Saved
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pending Receipts    â”‚
â”‚  Section             â”‚
â”‚                      â”‚
â”‚  [Receipt #123]      â”‚
â”‚  Downtown Store      â”‚
â”‚  $45.99              â”‚
â”‚  [Pay Now] â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€ NEW Button
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ User clicks "Pay Now" later
         â”‚
         â–¼

Step 5: Payment Modal
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Payment Modal       â”‚
â”‚                      â”‚
â”‚  Receipt #123        â”‚
â”‚  Total: $45.99       â”‚
â”‚                      â”‚
â”‚  Select Method:      â”‚
â”‚  [ğŸ’µ CASH]          â”‚
â”‚  [ğŸ’³ CARD]          â”‚
â”‚  [ğŸ“± MOBILE]        â”‚
â”‚  [ğŸ’° OTHER]         â”‚
â”‚                      â”‚
â”‚  [Complete Payment]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ User selects CASH and clicks Complete
         â”‚
         â–¼

Step 6: Payment Completed
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PUT /receipts/      â”‚
â”‚      123/complete    â”‚
â”‚                      â”‚
â”‚  {                   â”‚
â”‚    paymentMethod:    â”‚
â”‚      "CASH"          â”‚
â”‚  }                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼

Step 7: Receipt Completed
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Receipt Updated     â”‚
â”‚                      â”‚
â”‚  status: "COMPLETED" â”‚
â”‚  paymentMethod:      â”‚
â”‚    "CASH"            â”‚
â”‚                      â”‚
â”‚  Receipt moves to    â”‚
â”‚  History tab         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Payment Modal Component

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PaymentModal.tsx                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Props:                                            â”‚ â”‚
â”‚  â”‚  - visible: boolean                               â”‚ â”‚
â”‚  â”‚  - receipt: Receipt                               â”‚ â”‚
â”‚  â”‚  - onClose: () => void                            â”‚ â”‚
â”‚  â”‚  - onSuccess: () => void                          â”‚ â”‚
â”‚  â”‚                                                    â”‚ â”‚
â”‚  â”‚ State:                                             â”‚ â”‚
â”‚  â”‚  - selectedMethod: string (CASH/CARD/MOBILE/OTHER)â”‚ â”‚
â”‚  â”‚  - loading: boolean                                â”‚ â”‚
â”‚  â”‚                                                    â”‚ â”‚
â”‚  â”‚ Methods:                                           â”‚ â”‚
â”‚  â”‚  - handleCompletePayment()                         â”‚ â”‚
â”‚  â”‚    1. Validates payment method selected           â”‚ â”‚
â”‚  â”‚    2. Calls PUT /api/receipts/{id}/complete       â”‚ â”‚
â”‚  â”‚    3. Shows success/error alert                   â”‚ â”‚
â”‚  â”‚    4. Calls onSuccess() to reload receipts        â”‚ â”‚
â”‚  â”‚    5. Calls onClose() to dismiss modal            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      select     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ Items Screen â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     store        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â”‚ setCurrentStore()
                                        â–¼
                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚ StoreContext â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â”‚ currentStore
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   navigate to   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚Receipt Screenâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â”‚ reads currentStore
                                        â”‚ validates store
                                        â”‚ creates receipt
                                        â–¼
                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚   Backend    â”‚
                                 â”‚  POST /api/  â”‚
                                 â”‚   receipts   â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â”‚ returns Receipt
                                        â”‚ (PENDING status)
                                        â–¼
                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚  Pending     â”‚
                                 â”‚  Receipts    â”‚
                                 â”‚  List        â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   clicks "Pay Now"    â”‚
â”‚   User      â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ opens
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    selects      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Payment Modal â”‚    payment      â”‚   Backend    â”‚
â”‚              â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  PUT /api/   â”‚
â”‚ CASH/CARD/   â”‚    method        â”‚receipts/{id}/â”‚
â”‚ MOBILE/OTHER â”‚                  â”‚  complete    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â”‚ updates receipt
                                        â–¼
                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚   Receipt    â”‚
                                 â”‚  (COMPLETED) â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## State Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   State Hierarchy                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Global Context (via React Context API)
â”‚
â”œâ”€â”€ StoreContext â­ NEW
â”‚   â””â”€â”€ currentStore: Store | null
â”‚   â””â”€â”€ isStoreReady: boolean
â”‚
â”œâ”€â”€ ReceiptContext (existing)
â”‚   â””â”€â”€ receiptItems: ReceiptItem[]
â”‚   â””â”€â”€ customerName: string
â”‚   â””â”€â”€ paymentMethod: string (still used for old flow)
â”‚   â””â”€â”€ calculateTotal()
â”‚   â””â”€â”€ calculateTax()
â”‚   â””â”€â”€ clearReceipt()
â”‚
â””â”€â”€ ItemsApiContext (existing)
    â””â”€â”€ products: Product[]
    â””â”€â”€ loadProducts()

Local Component State
â”‚
â”œâ”€â”€ Items Screen
â”‚   â””â”€â”€ stores: Store[] (list of available stores)
â”‚   â””â”€â”€ showStoreSelector: boolean
â”‚
â”œâ”€â”€ Receipt Screen
â”‚   â””â”€â”€ pendingReceipts: Receipt[]
â”‚   â””â”€â”€ showPaymentModal: boolean
â”‚   â””â”€â”€ selectedReceiptForPayment: Receipt | null
â”‚
â””â”€â”€ Payment Modal
    â””â”€â”€ selectedMethod: string
    â””â”€â”€ loading: boolean
```

## API Endpoints

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API Endpoints                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Receipt Creation (Updated)
POST /api/receipts
Request:
{
  "storeId": "uuid",           â† From StoreContext
  "customerName": "John Doe",
  "items": [
    { "productId": "123", "quantity": 2 }
  ],
  "status": "PENDING"          â† NEW: No payment
}
Response:
{
  "id": 456,
  "receiptNumber": "RCP-123",
  "status": "PENDING",
  "storeId": "uuid",
  "total": 45.99,
  ...
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Payment Completion (New Endpoint)
PUT /api/receipts/{receiptId}/complete
Request:
{
  "paymentMethod": "CASH"
}
Response:
{
  "id": 456,
  "receiptNumber": "RCP-123",
  "status": "COMPLETED",       â† Updated
  "paymentMethod": "CASH",     â† Added
  "total": 45.99,
  ...
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Get Pending Receipts (Existing)
GET /api/receipts/pending
Response:
[
  {
    "id": 456,
    "receiptNumber": "RCP-123",
    "status": "PENDING",
    "total": 45.99,
    "paymentMethod": null,     â† null for pending
    ...
  }
]
```

## Error Handling

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Error Scenarios                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Scenario 1: No Store Selected
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Receipt Screen      â”‚
â”‚  currentStore = null â”‚ â”€â”€â–º Alert: "Go to Items page
â”‚                      â”‚            and select a store"
â”‚  [Save Receipt]      â”‚
â”‚  (Disabled)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Scenario 2: No Items Added
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Receipt Screen      â”‚
â”‚  receiptItems = []   â”‚ â”€â”€â–º Alert: "Please add items
â”‚                      â”‚            to the receipt"
â”‚  [Save Receipt]      â”‚
â”‚  (Disabled)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Scenario 3: Backend Error
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /api/receipts  â”‚
â”‚  Response: 500 Error â”‚ â”€â”€â–º Alert: "Failed to create
â”‚                      â”‚            receipt. Try again."
â”‚  Receipt not saved   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Scenario 4: Payment Completion Error
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PUT /complete       â”‚
â”‚  Response: 404       â”‚ â”€â”€â–º Alert: "Receipt not found
â”‚                      â”‚            or already completed"
â”‚  Modal stays open    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

This architecture ensures:
- âœ… Single source of truth for store selection
- âœ… Clear separation of concerns
- âœ… Type-safe communication between components
- âœ… Graceful error handling
- âœ… Intuitive user flow
